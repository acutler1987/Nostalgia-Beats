<!DOCTYPE html>
<html lang="en">
	<meta charset="UTF-8" />
	<title>Nostalgia Beats</title>
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<link rel="stylesheet" href="styles.css" />
	<style></style>
	<body>
		<header>
			<div class="header-text">
				<h1>Nostalgia Beats</h1>
				<p><i>an app powered by Spotify</i></p>
			</div>
		</header>
		<nav>
			<div class="nav-text">
				<div>
					<label for="age">How old are you?</label>
					<input type="text" id="age" name="age" /><br /><br />
				</div>
				<div>
					<label for="cars">I want to hear music from...</label>
					<select id="era" name="era">
						<option value="college_years">my college years.</option>
						<option value="high_school_years">
							my high school years.
						</option>
						<option value="childhood">my childhood years.</option>
					</select>
				</div>
			</div>
		</nav>
		<div class="container">
			<div id="login">
				<h1>This is an example of the Authorization Code flow</h1>
				<a href="/login" class="btn btn-primary">Log in with Spotify</a>
			</div>
			<div id="loggedin">
				<div id="user-profile"></div>
				<div id="oauth"></div>
				<button class="btn btn-default" id="obtain-new-token">
					Obtain new token using the refresh token
				</button>
			</div>
		</div>

		<script id="user-profile-template" type="text/x-handlebars-template">
			<h1>Logged in as {{display_name}}</h1>
			<div class='media'>
				<div class='pull-left'>
					<img
						class='media-object'
						width='150'
						src='{{images.0.url}}'
					/>
				</div>
				<div class='media-body'>
					<dl class='dl-horizontal'>
						<dt>Display name</dt><dd
							class='clearfix'
						>{{display_name}}</dd>
						<dt>Id</dt><dd>{{id}}</dd>
						<dt>Email</dt><dd>{{email}}</dd>
						<dt>Spotify URI</dt><dd><a
								href='{{external_urls.spotify}}'
							>{{external_urls.spotify}}</a></dd>
						<dt>Link</dt><dd><a href='{{href}}'>{{href}}</a></dd>
						<dt>Profile Image</dt><dd class='clearfix'><a
								href='{{images.0.url}}'
							>{{images.0.url}}</a></dd>
						<dt>Country</dt><dd>{{country}}</dd>
					</dl>
				</div>
			</div>
		</script>

		<script id="oauth-template" type="text/x-handlebars-template">
			<h2>oAuth info</h2>
			<dl class='dl-horizontal'>
				<dt>Access token</dt><dd
					class='text-overflow'
				>{{access_token}}</dd>
				<dt>Refresh token</dt><dd
					class='text-overflow'
				>{{refresh_token}}</dd>
			</dl>
		</script>

		<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
		<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
		<script>
			(function () {
				/**
				 * Obtains parameters from the hash of the URL
				 * @return Object
				 */
				function getHashParams() {
					var hashParams = {};
					var e,
						r = /([^&;=]+)=?([^&;]*)/g,
						q = window.location.hash.substring(1);
					while ((e = r.exec(q))) {
						hashParams[e[1]] = decodeURIComponent(e[2]);
					}
					return hashParams;
				}

				var userProfileSource = document.getElementById(
						'user-profile-template'
					).innerHTML,
					userProfileTemplate = Handlebars.compile(userProfileSource),
					userProfilePlaceholder =
						document.getElementById('user-profile');

				var oauthSource =
						document.getElementById('oauth-template').innerHTML,
					oauthTemplate = Handlebars.compile(oauthSource),
					oauthPlaceholder = document.getElementById('oauth');

				var params = getHashParams();

				var access_token = params.access_token,
					refresh_token = params.refresh_token,
					error = params.error;

				if (error) {
					alert('There was an error during the authentication');
				} else {
					if (access_token) {
						// render oauth info
						oauthPlaceholder.innerHTML = oauthTemplate({
							access_token: access_token,
							refresh_token: refresh_token,
						});

						$.ajax({
							url: 'https://api.spotify.com/v1/me',
							headers: {
								Authorization: 'Bearer ' + access_token,
							},
							success: function (response) {
								userProfilePlaceholder.innerHTML =
									userProfileTemplate(response);

								$('#login').hide();
								$('#loggedin').show();
							},
						});
					} else {
						// render initial screen
						$('#login').show();
						$('#loggedin').hide();
					}

					document
						.getElementById('obtain-new-token')
						.addEventListener(
							'click',
							function () {
								$.ajax({
									url: '/refresh_token',
									data: {
										refresh_token: refresh_token,
									},
								}).done(function (data) {
									access_token = data.access_token;
									oauthPlaceholder.innerHTML = oauthTemplate({
										access_token: access_token,
										refresh_token: refresh_token,
									});
								});
							},
							false
						);
				}
			})();
		</script>
		<div class="wrapper">
			<div class="music-container">
				<div class="music-menu">
					<ul class="menu-ul">
						<li class="menu-li"><a href="#">Songs</a></li>
						<li class="menu-li"><a href="#">Artists</a></li>
						<li class="menu-li"><a href="#">Year</a></li>
					</ul>
				</div>
				<ul class="music-playlist">
					<li class="song-container">
						<div class="press-play"></div>
						<div class="title"><p>interstate love song</p></div>
						<div class="artist"><p>stone temple pilots</p></div>
						<div class="year"><p>1994</p></div>
						<div class="length"><p>3:14</p></div>
					</li>
				</ul>
			</div>
			<div class="wrapper-text">
				<h1>nos·tal·gia</h1>
				<p2><i>noun</i></p2>
				<p>
					'A sentimental longing or wistful affection for the past,
					typically for a period or place with happy personal
					associations.'
				</p>
				<p>- Oxford Languages</p>
			</div>
		</div>

		<footer>
			<p>Last updated <span id="demo"></span></p>
			<script>
				document.getElementById('demo').innerHTML =
					document.lastModified;
			</script>
			<script
				data-main="app.js"
				src="node_modules/requirejs/require.js"
			></script>
		</footer>
	</body>
</html>
